# Mobile Transcode Rules for Lyrion Music Server
# Optimized custom-convert.conf rules for mobile Squeezebox clients
#
# This plugin provides optimized transcode rules for mobile streaming apps.
# Each app can define its own rules based on its specific needs.
#
# Installation:
# 1. Copy the rules for your app to LMS prefs/custom-convert.conf
# 2. Restart LMS
# 3. Your mobile app will automatically use these rules

# ============================================================================
# LyrPlay (iOS) - Optimized for iOS devices
# ============================================================================
# Note: Uses FT flag for fast pipeline launch to prevent timeout errors on iOS
# Conservative settings: 44.1kHz, 16-bit, moderate bitrates

# FLAC transcoding with headers for seek capability
flc flc LyrPlay *
	# FT:{START=--skip=%t}U:{END=--until=%v}D:{RESAMPLE=-r %d}
	[flac] -dcs $START$ $END$ --force-raw-format --sign=signed --endian=little -- $FILE$ | [sox] -q -t raw --encoding signed-integer -b $SAMPLESIZE$ -r $SAMPLERATE$ -c $CHANNELS$ -L - -t flac -r 44100 -C 0 -b 16 -

# Opus transcoding for superior bandwidth efficiency
# 256kbps provides excellent quality with smaller file sizes
flc ops LyrPlay *
	# FT:{START=--skip=%t}U:{END=--until=%v}D:{RESAMPLE=-r %d}
	[flac] -dcs $START$ $END$ --force-raw-format --sign=signed --endian=little -- $FILE$ | [opusenc] --raw --raw-bits=$SAMPLESIZE$ --raw-rate=$SAMPLERATE$ --raw-chan=$CHANNELS$ --bitrate=256 - -

# OGG Vorbis transcoding for bandwidth-efficient streaming
# Quality level 10 provides ~320kbps equivalent quality
flc ogg LyrPlay *
	# FT:{START=--skip=%t}U:{END=--until=%v}D:{RESAMPLE=-r %d}
	[flac] -dcs $START$ $END$ --force-raw-format --sign=signed --endian=little -- $FILE$ | [sox] -q -t raw --encoding signed-integer -b $SAMPLESIZE$ -r $SAMPLERATE$ -c $CHANNELS$ -L - -t ogg -C 10 -

# MP3 transcoding for broad compatibility
# Same as default flc->mp3 rule but without I flag for faster playback
flc mp3 LyrPlay *
	# FB:{BITRATE=--abr %B}T:{START=--skip=%t}U:{END=--until=%v}D:{RESAMPLE=--resample %D}
	[flac] -dcs $START$ $END$ -- $FILE$ | [lame] --silent -q $QUALITY$ $RESAMPLE$ $BITRATE$ - -

# ============================================================================
# Add Your App's Rules Here
# ============================================================================
# To add transcode rules for your mobile app:
#
# 1. Set your app's Model name in SlimProto HELO capabilities
#    Example: Model=YourApp
#
# 2. Copy the template below and customize:
#    - Replace "YourApp" with your model name
#    - Adjust flags (IFT/FT/IF/I/F) based on your app's needs
#    - Set quality parameters (sample rate, bit depth, bitrate)
#
# 3. Test thoroughly with your app
#
# 4. Share your rules with the community!
#
# Template:
#
# flc flc YourApp *
#     # IFT:{START=--skip=%t}U:{END=--until=%v}D:{RESAMPLE=-r %d}
#     [flac] -dcs $START$ $END$ --force-raw-format --sign=signed --endian=little -- $FILE$ | [sox] -q -t raw --encoding signed-integer -b $SAMPLESIZE$ -r $SAMPLERATE$ -c $CHANNELS$ -L - -t flac -r 44100 -C 0 -b 16 -
#
# flc ops YourApp *
#     # IFT:{START=--skip=%t}U:{END=--until=%v}D:{RESAMPLE=-r %d}
#     [flac] -dcs $START$ $END$ --force-raw-format --sign=signed --endian=little -- $FILE$ | [opusenc] --raw --raw-bits=$SAMPLESIZE$ --raw-rate=$SAMPLERATE$ --raw-chan=$CHANNELS$ --bitrate=256 - -
#
# flc ogg YourApp *
#     # IFT:{START=--skip=%t}U:{END=--until=%v}D:{RESAMPLE=-r %d}
#     [flac] -dcs $START$ $END$ --force-raw-format --sign=signed --endian=little -- $FILE$ | [sox] -q -t raw --encoding signed-integer -b $SAMPLESIZE$ -r $SAMPLERATE$ -c $CHANNELS$ -L - -t ogg -C 10 -
